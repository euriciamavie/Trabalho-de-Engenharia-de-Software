<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <title>Tarefa</title>
    <meta name='viewport' content='width=device-width, initial-scale=1'>
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous"><link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
</head>

<style>
    body{
        margin: 0px;
        padding: 0px;
        background-image: url(img.png);
    }

    #conteiner{
        border: 1px solid white;
        /* padding: 200px 200px 500px 800px; */
        width: 1000px;
        height: 650px;
        margin-left: 20px;
        border-radius: 10px; 
        overflow: hidden;
        display: flex;
        flex-direction: column;
        position: relative;
        overflow-y: auto;
    }


    #cabecalho{
        background-color: black; 
        padding: 30px;
        color: white;
        font-family: 'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif;
        font-weight: bold;
        display: flex;
        font-size: 14pt;
    }

    #cabecalho #logo{
        margin-right: 910px;
    }

    #navegacao ul {
    list-style-type: none;
    padding: 0;
    margin-top: 170px;
    }

    #navegacao li {
        margin-bottom: 60px; /* Espaçamento entre os itens da lista */
    }

    #navegacao a {
        text-decoration: none;
        padding: 20px 40px;
        background-color: #3498dbb6;
        color: #ffffff;
        /* border-radius: 5px; */
        transition: background-color 0.3s ease;
        display: block; /* Torna os links de navegação em blocos para ocupar a largura total */
        text-align: center;
        font-family: 'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif;
        /* font-weight: bold; */
        font-size: 14pt;
    }

    #navegacao a:hover {
        background-color: #0f5b8d;
    }

    #corpo{
        margin-top: 20px;
        display: flex;
	margin-left: 50px;
    }

    #conteiner img{
        width: 100%;
        height: 100%;
    }


/* -----------------------------------tabela-------------------------------------------------- */
table {
            width: 100%;
            border-collapse: collapse;
            color: white;
        }

        th, td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #0f5b8d;
        }



        tbody tr:hover {
            background-color: #0f5b8d;
        }

        th {
            background-color: #0f5b8d41;
        }

        td{
           
        }


        #categoriaTxt,#novaTxt{
            color: white;
            /* margin-top: -300px;
            margin-left: -860px;
            margin-bottom: 100px; */
            
        }

        #categoriaTxt{
            /* margin-top: -200px; */
            margin-bottom: 10px;
            font-family: 'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif;
            font-size: 30px;
        }

        #novaTxt{
            margin-bottom: 20px;
            background-color: #000000b6;
            font-family: 'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif;
            font-size: 20px;
            padding: 15px;

        }

        #a {
            margin-right: 600px; /* Adiciona espaçamento à direita de cada <span> dentro de #novaTxt */
        }
/* -----------------------------------/tabela-------------------------------------------------- */
    

/* -----------------------------botao Nova--------------------- */
.new-button {
    background-color: #4caf50; 
    color: white; 
    border: none; 
    padding: 10px 20px; 
    font-size: 16px; 
    cursor: pointer;
    border-radius: 5px;
    margin-left: 32px; 

}

.new-button .icon {
    font-weight: bold;
}

.new-button:hover{
    background-color: #4caf4fc0;
}
/* -----------------------------botao--------------------- */



/* ------------------------------------botao excluir e editar-------------------------- */


.editar-button, .excluir-button {
    background-color: #4caf50;
    color: white;
    border: none;
    padding: 8px 16px;
    margin-right: 5px;
    cursor: pointer;
    border-radius: 5px;
    font-size: 12px;
}

.excluir-button {
    background-color: #f44336;
}

.bt{
    width: 180px;
}

.excluir-button:hover{
    background-color: #f44336bb;
}

.editar-button:hover{
    background-color: #4caf4fb9;
}
/* ------------------------------------botao excluir e editar-------------------------- */





/* ==============================Modal===================================== */

#modalOverlay {
    display: none;
    position: fixed;
    z-index: 1;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.4);
}

/* Estilo para o modal de formulário */
.modal {
    display: none;
    position: fixed;
    z-index: 2;
    left: 58%;
    top: 50%;
    transform: translate(-50%, -50%); 
    padding: 10px;
    border: 1px solid #07a4b9;
    box-shadow: 0px 0px 10px 0px rgba(0, 0, 0, 0.5);
    max-width: 400px;
    width: 100%; 
    height: 75%;
    background-color: black;
    font-family: 'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif;
}

/* Estilo para o botão de fechar  */
 .close {
    color: #aaa;
    float: right;
    font-size: 28px;
    font-weight: bold;
} 

.close:hover,
.close:focus {
    color: black;
    text-decoration: none;
    cursor: pointer;
}

/* Estilo para o botão de formulário */
.new-buttonModal {
    background-color: #4caf50;
    color: white;
    border: none;
    padding: 10px 20px;
    font-size: 16px;
    cursor: pointer;
    border-radius: 5px;
    margin-top: 10px;
    margin-left: 40%;
}

.new-buttonModal:hover {
    background-color: #4caf4fc0;
}

#myModal{
    color: white;
}

.modal-content{
   background-color:#0f5b8d41;
}
/* ====================================/Modal==================================== */



/* ------------------------------calendario----------------------------- */

/* ------------------------------calendario----------------------------- */

#form input{
            display: block;
            width: 100%;
            font-size: 16px;
            border: 1px solid #ccc;
            border-radius: 5px;
            margin-top: 5px;
            font-size: 15pt;
            padding: 3px;
            border-style: none;
            font-family: 'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif;          
}


    .pendente {
        color: rgba(255, 174, 0, 0.952); /* Define a cor vermelha para o status "Pendente" */
        font-family: 'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif;
        font-weight: bold;
        font-size: 13pt;
    }

    .concluido {
        color: rgb(10, 221, 17);
        font-family: 'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif;
        font-weight: bold;
        font-size: 13pt;
    }
/* ----------------------------------------------ModalEdit--------------------------- */
.overlayUP {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5); /* Ajuste a opacidade conforme necessário */
    z-index: 1;
}

/* Estilo para o modal de edição */
#modalEditar {
    display: none;
    position: fixed;
    z-index: 2;
    left: 50%;
    top: 50%;
    transform: translate(-50%, -50%);
    padding: 10px;
    border: 1px solid #07a4b9;
    box-shadow: 0px 0px 10px 0px rgba(0, 0, 0, 0.5);
    max-width: 400px;
    width: 100%;
    background-color: black;
    font-family: 'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif;
    color: white;
}

/* Adicione estes estilos para centralizar os campos do formulário dentro do modal */
#formEditar {
    display: flex;
    flex-direction: column;
    align-items: center;
}

/* Adicione um estilo para o botão de fechar do modal de edição */
.closeUP {
    color: #aaa;
    float: right;
    font-size: 28px;
    font-weight: bold;
    cursor: pointer;
}

.closeUP:hover,
.closeUP:focus {
    color: white;
    text-decoration: none;
}

/* Adicione um estilo para o botão "Salvar Alterações" */
#formEditar .new-buttonModal {
    background-color: #4caf50;
    color: white;
    border: none;
    padding: 10px 20px;
    font-size: 16px;
    cursor: pointer;
    border-radius: 5px;
    margin-top: 10px;
}

#formEditar .new-buttonModal:hover {
    background-color: #4caf4fc0;
}


    #modalEditar{
        display: none;
    }
/* ----------------------------------------------ModalEdit--------------------------- */
</style>

<body>
    <!-- Cabecalho -->
    <nav id="cabecalho">
        <div id="logo">
            <img src="LOGO_RM_HORIZONTAL.png" style="width: 140px; height: 50px;">
        </div>
        <div>
            <a href="Login.html" style="color: rgb(236, 240, 7); text-decoration: none; margin-left: 300px; font-weight: bolder;">Sair</a>
        </div>
     </nav>
    
    <!-- Menu de navegacao -->
    <div id="corpo">        
        <nav id="navegacao">
            <ul>
                <li><a href="index.html">Painel de Controlo</a></li>
                <li><a href="Categoria.html">Categorias</a></li>
                <li><a href="Tarefa.html">Tarefa</a></li>
                           
            </ul>
        </nav>

        <div id="conteiner" style="justify-content: center; display: flex; align-items: center;">  
            <div id="categoriaTxt" style="width: 900px;">
                <span>Tarefas</span>
            </div>

            <div id="novaTxt" style="width: 900px;">
                <span id="a">Lista de Tarefas</span>
                <button class="new-button" id="openModalBtn">
                    <span class="icon" style="margin-right: 5px;">+</span>Nova
                </button>
            </div>

            <div id="tb"style="max-height: 400px; overflow-y: auto; border: 1px solid #ccc; height: 400px;">    
            <table style="width: 900px; height: auto;">
                    <thead>
                        <tr>
                            <th>Codigo</th>
                            <th>Descricao</th>
                            <th>Data Inicio</th>
                            <th>Data Fim</th>
                            <th>Categoria</th>
                            <th>Status</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody id="tabelaBody">
                       
                    </tbody>
            </table>
            </div>
        </div>

    <!-- ------------------------------Modal---------------------------------------- -->           
            <div id="modalOverlay"></div>
            <div id="myModal" class="modal" style="height: 700px; width: 600px;">
            <div class="modal-content" style="background-color: black;">
            <span class="close">&times;</span>
            <h2 style="text-align: center; margin-bottom: 30px;">Nova Tarefa</h2>
            <form id="form" action="http://localhost/Gestao_de_Tarefas/save_tarefa.php" method="POST">
                <label for="categoria">Categoria da Tarefa:</label>
                <select id="categoria" name="categoria" style="padding: 8px; padding-right: 62%; min-width: 60%; width: 375px;">
                    <!-- Options serão preenchidas dinamicamente com os dados da tabela de categorias -->
                </select><br><br>
                <label for="descricao">Descrição:</label>
                <input type="text" id="descricao" name="descricao"><br><br>
                <label for="dataInicio">Data Inicio:</label>
                <input type="date" id="dataInicio" name="dataInicio"><br><br>
                <label for="dataFim">Data Fim:</label>
                <input type="date" id="dataFim" name="dataFim"><br><br>
                <label>Prioridade</label>
                <select id="prioridade" name="prioridade" style="padding: 8px; padding-right: 62%; min-width: 60%; width: 375px;">
                    <option>Alta</option>
                    <option>Media</option>
                    <option>Baixa</option>
                </select><br><br>
                <button type="submit" class="new-buttonModal" name="salvar">Salvar</button>
            </form>
        </div>
    </div>   
    
    <!-- ----------------------------------/Modal------------------------------------------>



    <!-- ----------------------------------/ModalUpdate------------------------------------------>

    <div class="overlayUP" id="overlayUP"></div>

    <div id="modalEditar" class="modalUP" style="height: 610px; padding-top: 30px; padding-bottom: 10px;">
        <div class="modal-contentUP" style="background-color: black;">
            <span class="closeUP" onclick="fecharModalEditar()">&times;</span>
            <h2 style="text-align: center; margin-bottom: 30px;">Editar Tarefa</h2>
            <form id="formEditar" action="http://localhost/Gestao_de_Tarefas/save_tarefa.php" method="POST">
                <!-- Adicione os campos do formulário de edição aqui -->
                <input type="hidden" id="codigoTarefaEdit" name="codigoTarefa">
                <label for="descricaoEdit">Descrição:</label>
                <input type="text" id="descricaoEdit" name="descricaoEdit" style="padding: 8px; width: 375px;"><br><br>
                <label for="dataInicioEdit">Data Início:</label>
                <input type="date" id="dataInicioEdit" name="dataInicioEdit" style="padding: 8px; width: 375px;"><br><br>
                <label for="dataFimEdit">Data Fim:</label>
                <input type="date" id="dataFimEdit" name="dataFimEdit" style="padding: 8px; width: 375px;"><br><br>
                <label>Prioridade</label>
                <select id="prioridade" name="prioridade" style="padding: 8px; width: 375px;">
                    <option>Alta</option>
                    <option>Media</option>
                    <option>Baixa</option>
                </select><br><br>
                <button type="submit" class="new-buttonModal" name="salvarEdit" style="margin-left:-5px;">Salvar Alterações</button>
            </form>
        </div>
    </div>
      <!-- ----------------------------------/ModalUpdate------------------------------------------>


    <script>
        var modal = document.getElementById("myModal");
        var overlay = document.getElementById("modalOverlay");
        var btn = document.getElementById("openModalBtn");
        var span = document.getElementsByClassName("close")[0];


    // btn.onclick = function() {
    //     modal.style.display = "block";
    //     overlay.style.display = "block";
    // }

    span.onclick = function() {
        modal.style.display = "none";
        overlay.style.display = "none";
    }

    window.onclick = function(event) {
        if (event.target == overlay) {
            modal.style.display = "none";
            overlay.style.display = "none";
        }
    }



        var btnUP = document.getElementById("openModalUP");
        var modalUP = document.getElementById("modalEditar");
        var overlayUP = document.getElementById("overlayUP");
        var spanUP = document.getElementsByClassName("closeUP")[0];

        spanUP.onclick = function() {
            modalUP.style.display = "none";
            overlayUP.style.display = "none";
        }

        window.onclick = function(event) {
        if (event.target == overlayUP) {
            modalUP.style.display = "none";
            overlayUP.style.display = "none";
        }
        }
   
    // ------------------------------------PrencherOs dados-------------------------------------
    $(document).ready(function () {
        $.ajax({
            url: 'http://localhost/Gestao_de_Tarefas/listarTabelaTarefa.php',
            type: 'GET',
            dataType: 'html',
            success: function (response) {
                $('#tabelaBody').html(response);
            },
            error: function (error) {
                console.log(error);
            }
        });
    });
// ------------------------------------/PrencherOs dados-------------------------------------


// ------------------------------------/PrencherOs dados-------------------------------------

      

document.addEventListener('DOMContentLoaded', function () {
        document.getElementById('conteiner').addEventListener('click', function (event) {
            if (event.target && event.target.classList.contains('excluir-button')) {
                var codigoTarefa = event.target.getAttribute('data-codigo');
    
                if (confirm("Deseja realmente excluir a categoria?")) {
                    var xhr = new XMLHttpRequest();
                    // Configurar uma requisição DELETE assíncrona
                    xhr.open('DELETE', 'http://localhost/Gestao_de_Tarefas/save_tarefa.php', true);

                    // Configurar o cabeçalho da requisição
                    xhr.setRequestHeader('Content-Type', 'application/json');

                    // Configurar a função de retorno de chamada quando a requisição estiver concluída
                    xhr.onload = function () {
                        if (xhr.status >= 200 && xhr.status < 300) {
                            // A requisição foi bem-sucedida
                            console.log('Categoria excluída com sucesso!');
                            // Aqui você pode atualizar a tabela ou fazer outras ações necessárias
                        } else {
                            // Houve um erro na requisição
                            console.error('Erro ao excluir tarefa: ' + xhr.statusText);
                        }
                    };

                    // Configurar a função de retorno de chamada para lidar com erros de rede
                    xhr.onerror = function () {
                        console.error('Erro de rede ao excluir categoria.');
                    };

                    // Enviar a requisição com o código da categoria como parâmetro
                    var data = { codigo_tarefa: codigoTarefa }; // Ajuste aqui
                        xhr.send(JSON.stringify(data)); // Ajuste aqui
                    }
            }
            });
        });
        function excluirLinha(button) {
            var row = button.parentNode.parentNode;
            row.parentNode.removeChild(row);
        }
// ----------------------------------------Exluir---------------------------------------------


function preencherComboBoxCategorias() {
    $.ajax({
        url: 'http://localhost/Gestao_de_Tarefas/save_categoria.php', // Substitua pela URL correta
        type: 'GET',
        dataType: 'json',
        success: function (response) {
            // Limpe as opções atuais
            $('#categoria').empty();
            
            // Adicione as novas opções com base nos dados recebidos
            for (var i = 0; i < response.length; i++) {
                $('#categoria').append('<option value="' + response[i].categoria_nome + '">' + response[i].categoria_nome + '</option>');
            }
        },
        error: function (error) {
            console.log(error);
        }
    });
}

// Chame esta função quando o modal for aberto (por exemplo, após clicar no botão Nova Tarefa)
btn.onclick = function () {
    modal.style.display = "block";
    overlay.style.display = "block";
    preencherComboBoxCategorias(); // Chame a função aqui
};


$(document).ready(function () {
    // ...

    // Adicione um ouvinte de eventos para os botões "Editar"
    $('#tabelaBody').on('click', '.editar-button', function () {
        // Obtém o código da tarefa associado ao botão clicado
        var codigoTarefa = $(this).data('codigo');

        // Aqui você pode obter os detalhes da tarefa correspondente usando AJAX e preencher o modal de edição
        // Para simplificar, vou apenas abrir o modal neste exemplo
        abrirModalEdicao(codigoTarefa);
    });
});


function abrirModalEdicao(codigoTarefa) {
    
    // Faz uma requisição AJAX para obter os detalhes da tarefa com o código especificado
    $.ajax({
        url: 'http://localhost/Gestao_de_Tarefas/save_tarefa.php', // Substitua pela URL correta
        type: 'GET',
        data: { codigo_tarefa: codigoTarefa },
        dataType: 'json',
        success: function (response) {
            // Preenche os campos do modal com os detalhes obtidos
            $('#codigoTarefaEdit').val(response.codigo_tarefa);
            $('#descricaoEdit').val(response.descricao);
            $('#dataInicioEdit').val(response.data_inicio);
            $('#dataFimEdit').val(response.data_fim);
            $('#categoriaEdit').val(response.categoria);

            // Abre o modal de edição
            $('#overlayUP').show();
            $('#modalEditar').show();
        },
        error: function (error) {
            console.error('Erro ao obter detalhes da tarefa: ' + error);
        }
    });
}


$(document).ready(function () {
    // ...

    // Adicione um ouvinte de eventos para o botão "Salvar Alterações"
    $('#formEditar').on('click', '#openModalUP', function (event) {
        event.preventDefault(); // Impede o envio padrão do formulário

        // Obtenha os valores dos campos do formulário
        var codigoTarefa = $('#codigoTarefaEdit').val();
        var novaDescricao = $('#descricaoEdit').val();
        var novaDataInicio = $('#dataInicioEdit').val();
        var novaDataFim = $('#dataFimEdit').val();
        var novaCategoria = $('#categoriaEdit').val();

        // Construa um objeto com os valores dos campos
        var data = {
            codigo_tarefa: codigoTarefa,
            nova_descricao: novaDescricao, 
            nova_data_inicio: novaDataInicio,
            nova_data_fim: novaDataFim,
            nova_categoria: novaCategoria
        };

        // Envie uma solicitação AJAX para atualizar os dados no servidor 
        $.ajax({
            url: 'http://localhost/Gestao_de_Tarefas/save_tarefa.php',
            type: 'POST',
            contentType: 'application/json',
            data: JSON.stringify(data),
            success: function (response) {
                // Lógica após a atualização bem-sucedida
                console.log(response);

                // Feche o modal de edição e o overlay
                //fecharModalEditar();
            },
            error: function (error) {
                // Lógica de tratamento de erro
                console.error(error);
            }
        });
    });
});


   </script>  
    <!-- <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script> -->
</body>
</html>